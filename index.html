<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>El impostor de Valorant</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background-color: #0f1923; color: white; }
    input, button { padding: 10px; margin: 5px; border-radius: 5px; border: none; }
    input { width: 250px; }
    .link-box { margin-top: 20px; }
    .link-box input { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>El Impostor de Valorant</h1>
  <p>Escriban todos sus nombres y hagan clic en "Jugar". Un jugador ser√° el impostor, los dem√°s tendr√°n el mismo agente.</p>
  <div>
    <input type="text" id="nombreInput" placeholder="Nombre del jugador">
    <button onclick="agregarNombre()">Agregar</button>
  </div>
  <div id="nombresLista"></div>
  <button onclick="generarRoles()">Jugar</button>
  <div class="link-box" id="linksGenerados"></div>

  <script>
    const agentes = ["Jett", "Reyna", "Phoenix", "Sage", "Killjoy"];
    const nombres = [];
    const asignaciones = {};

    function generarID() {
      return Math.random().toString(36).substring(2, 10);
    }

    function agregarNombre() {
      const input = document.getElementById('nombreInput');
      const nombre = input.value.trim();
      if (nombre && !nombres.includes(nombre)) {
        nombres.push(nombre);
        const lista = document.getElementById('nombresLista');
        lista.innerHTML = nombres.map(n => `üë§ ${n}`).join('<br>');
        input.value = '';
      }
    }

    function generarRoles() {
      if (nombres.length < 3) {
        alert("Agrega al menos 3 jugadores.");
        return;
      }

      const impostorIndex = Math.floor(Math.random() * nombres.length);
      const agente = agentes[Math.floor(Math.random() * agentes.length)];
      const container = document.getElementById("linksGenerados");
      container.innerHTML = "<h3>Links para copiar y enviar</h3>";

      nombres.forEach((nombre, i) => {
        const id = generarID();
        asignaciones[id] = {
          nombre: nombre,
          rol: i === impostorIndex ? "IMPOSTOR" : agente
        };

        // Guardamos en localStorage
        localStorage.setItem(`rol-${id}`, JSON.stringify(asignaciones[id]));

        const link = `${location.origin + location.pathname}?id=${id}`;
        container.innerHTML += `
          <div>
            <input type="text" value="${link}" readonly onclick="this.select()">
          </div>
        `;
      });
    }

    // Mostrar rol al abrir link con id
    window.onload = function() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");

      if (id) {
        const data = JSON.parse(localStorage.getItem(`rol-${id}`));
        if (data) {
          const { nombre, rol } = data;
          document.body.innerHTML = `
            <h1>Hola ${nombre}!</h1>
            <h2>Tu rol es:</h2>
            <h1 style='color: ${rol === "IMPOSTOR" ? "red" : "lightgreen"}; font-size: 4em;'>${rol}</h1>
          `;
        } else {
          document.body.innerHTML = `<h1 style='color: red;'>Rol no encontrado o expirado.</h1>`;
        }
      }
    }
  </script>
</body>
</html>
