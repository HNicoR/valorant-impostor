<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Asignador de roles Valorant - Impostor</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; background: #121212; color: #eee;}
  input, button, textarea { font-size: 1rem; padding: 0.5rem; width: 100%; margin: 0.5rem 0; }
  button { background: #ff4655; border: none; color: white; cursor: pointer; }
  .hidden { display: none; }
  .role { margin-top: 2rem; font-size: 1.4rem; font-weight: bold; color: #ff4655; }
  a { color: #ff4655; }
</style>
</head>
<body>

<h1>Asignador de roles Valorant - Impostor</h1>

<div id="setup">
  <p>Ingresá los nombres de los jugadores, uno por línea:</p>
  <textarea id="players" rows="6" placeholder="Ejemplo: Nico&#10;Juan&#10;María"></textarea>
  <button id="generate">Generar códigos únicos</button>
  <p id="error" style="color: #ff4655;"></p>
</div>

<div id="links" class="hidden">
  <h2>Compartí estos links con cada jugador (cada uno debe abrir solo el suyo):</h2>
  <ul id="linkList"></ul>
  <button id="reset">Resetear todo</button>
</div>

<div id="roleView" class="hidden">
  <h2>Tu rol es:</h2>
  <p class="role" id="roleText"></p>
</div>

<script>
(() => {
  // Lista fija de roles de Valorant (modificá si querés)
  const valorantRoles = [
    "Jett", "Sage", "Phoenix", "Reyna", "Sova",
    "Viper", "Brimstone", "Killjoy", "Cypher", "Raze"
  ];

  const params = new URLSearchParams(window.location.search);
  const code = params.get("code");

  // Variables globales
  let assignments = null;

  // Función para generar un código único simple
  function generateCode(name) {
    return btoa(name + Math.random()).replace(/=/g, "").slice(0,8);
  }

  // Función para mezclar un array (Fisher-Yates)
  function shuffle(array) {
    let currentIndex = array.length, randomIndex;
    while (currentIndex !== 0) {
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex--;
      [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
    }
    return array;
  }

  // Guardar assignments en localStorage para persistencia simple
  function saveAssignments(data) {
    localStorage.setItem("valorantImpostorAssignments", JSON.stringify(data));
  }
  function loadAssignments() {
    const data = localStorage.getItem("valorantImpostorAssignments");
    return data ? JSON.parse(data) : null;
  }
  function clearAssignments() {
    localStorage.removeItem("valorantImpostorAssignments");
  }

  // Mostrar el rol según el código (modo jugador)
  function showRole(code) {
    const data = loadAssignments();
    if (!data) {
      document.body.innerHTML = "<p style='color:#ff4655'>No hay roles asignados. Pidan al organizador generar los códigos.</p>";
      return;
    }
    const entry = data.find(e => e.code === code);
    if (!entry) {
      document.body.innerHTML = "<p style='color:#ff4655'>Código inválido o expirado.</p>";
      return;
    }
    document.getElementById("setup").classList.add("hidden");
    document.getElementById("links").classList.add("hidden");
    document.getElementById("roleView").classList.remove("hidden");
    document.getElementById("roleText").textContent = entry.role;
  }

  // Generar asignaciones
  function generateAssignments(names) {
    // Shuffle jugadores
    const players = shuffle(names.slice());

    // Elegir impostor aleatorio
    const impostorIndex = Math.floor(Math.random() * players.length);

    // Crear lista de roles para repartir (sin el impostor)
    let rolesPool = shuffle(valorantRoles.slice());
    // Si hay más jugadores que roles, se repiten roles (podés modificar si querés)
    while (rolesPool.length < players.length - 1) {
      rolesPool = rolesPool.concat(shuffle(valorantRoles));
    }

    // Asignar roles
    const assignments = players.map((player, i) => {
      const code = generateCode(player);
      return {
        name: player,
        code,
        role: i === impostorIndex ? "Sos el IMPOSTOR" : rolesPool.pop()
      };
    });
    return assignments;
  }

  // Mostrar links para cada jugador
  function displayLinks(assignments) {
    const ul = document.getElementById("linkList");
    ul.innerHTML = "";
    assignments.forEach(({name, code}) => {
      const li = document.createElement("li");
      const url = `${window.location.origin}${window.location.pathname}?code=${code}`;
      li.innerHTML = `<b>${name}:</b> <a href="${url}" target="_blank">${url}</a>`;
      ul.appendChild(li);
    });
  }

  // Eventos
  if (code) {
    // Si el link tiene código, mostrar rol
    showRole(code);
  } else {
    // Página para generar asignaciones
    const setupDiv = document.getElementById("setup");
    const linksDiv = document.getElementById("links");
    const errorP = document.getElementById("error");

    document.getElementById("generate").addEventListener("click", () => {
      errorP.textContent = "";
      let raw = document.getElementById("players").value.trim();
      if (!raw) {
        errorP.textContent = "Por favor, ingresá al menos 2 jugadores.";
        return;
      }
      let players = raw.split("\n").map(s => s.trim()).filter(s => s.length > 0);
      if (players.length < 2) {
        errorP.textContent = "Necesitás al menos 2 jugadores para jugar.";
        return;
      }
      // Generar asignaciones
      assignments = generateAssignments(players);
      saveAssignments(assignments);
      displayLinks(assignments);
      setupDiv.classList.add("hidden");
      linksDiv.classList.remove("hidden");
    });

    document.getElementById("reset").addEventListener("click", () => {
      clearAssignments();
      location.reload();
    });
  }
})();
</script>

</body>
</html>
